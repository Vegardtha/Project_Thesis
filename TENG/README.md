# TENG Data Acquisition System

A Python-based data acquisition and analysis system for Triboelectric Nanogenerator (TENG) experiments using Digilent Analog Discovery oscilloscopes.

## Overview

This system provides automated data collection, triggered signal acquisition, and also include some basic analysis tools for TENG impact testing. It interfaces with Digilent oscilloscopes to capture voltage signals generated by TENG devices under various experimental conditions.

## Features

- **Automated Data Acquisition**: Trigger-based recording of TENG voltage signals
- **Configurable Experiment Parameters**: Easy-to-adjust sampling rates, trigger levels, and acquisition times
- **Real-time Monitoring**: Live feedback during data collection
- **Data Persistence**: Automatic saving of time-series data and experiment configurations
- **Visualization Tools**: The folder also include some built-in plotting utilities for data analysis, but could be improved
- **Noise Analysis**: Basic tools we used to analyzie and characterize noise in new TENG signals.

## Requirements

### Software Dependencies


Required packages:
- `numpy` - Numerical computing
- `pandas` - Data manipulation and analysis
- `matplotlib` - Data visualization
- `pyserial` - Serial communication

Found in `requirements.txt` for easy installation. See Installation section below.

### Hardware Requirements

- **Digilent Analog Discovery** (or compatible oscilloscope)
- **Digilent WaveForms SDK** - Must be installed separately for non-mac devices (Running Waveforms SDK on macOS have given issues i have not been able to resolve yet)
  - Download from: [Digilent WaveForms](https://digilent.com/shop/software/digilent-waveforms/)

## Installation

1. **Clone or download this repository**

2. **Create a virtual environment** (recommended):
   ```bash
   # On macOS/Linux
   python -m venv .venv
   source .venv/bin/activate
   
   # On Windows
   python -m venv .venv
   .venv\Scripts\activate
   ```

3. **Install dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

4. **Install Digilent WaveForms SDK**:
   - Download and install from the Digilent website
   - The software includes the required `dwf` library

## Quick Start

### Running an Experiment

1. **Configure your experiment** in `run_experiment.py`:

```python
config = ExperimentConfig(
    name="MyExperiment",
    description="TENG impact testing",
    num_acquisitions=10,
    
    oscilloscope=OscilloscopeConfig(
        sampling_frequency=500e3,    # 500 kHz
        acquisition_time_ms=15,      # 15 ms recording window
        amplitude_range=50,          # ±25V range
        trigger_level=0.5            # Trigger at 2V
    ),
    
    save_plots=True
)
```

2. **Run the experiment**:
```bash
python run_experiment.py
```

3. **Results** are saved automatically to `experiments/<ExperimentName_Timestamp>/`

> **Note:** The configuration values shown above are the standard settings used in our testing. To understand how the parameters work and test what is optimal for your project, it is recommended to use the Digilent WaveForms application interactively.

## Project Structure

```
TENG/
├── run_experiment.py          # Main experiment runner
├── requirements.txt           # Python dependencies
├── arduino_script/
│   └── motorcontroller.ino   # Example script for Arduino stepper motor controller
├── hardware/
│   ├── oscilloscope.py       # Oscilloscope controller
│   └── __init__.py
├── utils/
│   ├── experiment_manager.py # Experiment orchestration
│   ├── experiment_config.py  # Configuration classes
│   ├── dwfconstants.py       # Digilent constants
│   └── __init__.py
├── plotting/
│   └── plotter.py            # Data visualization tools
├── noise_testing/
│   ├── record_static_noise.py # Noise characterization
│   └── noise_analysis.ipynb   # Noise analysis notebook
└── experiments/               # Output directory for results
```

## Configuration Parameters

### Arduino Motor Controller

> **Note:**  In (`arduino_script/motorcontroller.ino`) a script for controlling a stepper motor via an Arduino that can be found. Copy the file and upload it using the Arduino IDE or PlatformIO.
For now just a prototype, but works well enough for our testing.


#### Pin Configuration

| Pin | Function | Description |
|-----|----------|-------------|
| 9 | PUL_PIN | Step pulse output to stepper driver |
| 8 | DIR_PIN | Direction control (HIGH/LOW) |
| 7 | ENA_PIN | Enable/disable driver (active LOW) |
| 5 | END_STOP_PIN_1 | forward limit switch, not necessary necessary, but will help the motor from not skipping (INPUT_PULLUP) |
| 3 | AUTO_TRIGGER_PIN | Digital trigger input for auto-cycle |

#### Motor Configuration Parameters

| Parameter | Value | Description |
|-----------|-------|-------------|
| `MAX_SPEED` | 4000 steps/s | Maximum motor speed for forward movement |
| `ACCELERATION` | 8000 steps/s² | Acceleration/deceleration rate |
| `SLOW_SPEED` | 100 steps/s | Slower return speed after impact |
| `FORWARD_STEPS` | 130 steps | Distance to move forward (~1.5cm) |
| `BACKUP_STEPS` | 125 steps | Distance to return after impact (Gap distance from theory) |
| `WAIT_TIME` | 1000 ms | Pause before return movement |
| `SLEEP_TIME` | 3000 ms | Delay after cycle completion |
| `DEBOUNCE_DELAY` | 50 ms | Debounce time for trigger pin |

#### Usage

**Serial Commands:**
- Send any integer: Move that many steps (positive = forward, negative = backward)
- Send `1`: Execute auto-cycle (move to end stop, wait, return, disable)

**Basic Auto-Cycle Sequence:**
1. Move forward up to 130 steps or until left end stop is triggered
2. Wait 1 second
3. Return slowly 125 steps
4. Disable motor and sleep for 3 seconds

### OscilloscopeConfig

| Parameter | Description | Default |
|-----------|-------------|---------|
| `sampling_frequency` | Sampling rate in Hz | 2 MHz |
| `acquisition_time_ms` | Recording duration per trigger (ms) | 30 ms |
| `amplitude_range` | Peak-to-peak voltage range (V) | ±50V |
| `trigger_level` | Voltage threshold for triggering (V) | 2V |
| `channel` | Oscilloscope channel (1 or 2) | 1 |
| `offset` | DC voltage offset (V) | 0V |

### ExperimentConfig

| Parameter | Description | Default |
|-----------|-------------|---------|
| `name` | Experiment identifier | "TENG_Test" |
| `description` | Experiment description | - |
| `num_acquisitions` | Number of recordings to capture | 10 |
| `save_plots` | Generate summary plots | True |

## Output Data

Each experiment creates a timestamped directory containing:

- **`cycle_*.csv`** - Time-series voltage data for each acquisition
  - Columns: `time_s`, `voltage_v`
- **`experiment_config.txt`** - Complete experiment configuration
- **`*.png`** - Generated plots (if enabled)

## Troubleshooting

### Oscilloscope Connection Issues

**Error: "Could not find dwf.framework"**
- Install Digilent WaveForms from the official website
- Check the library location for your operating system:
  - **macOS**: `/Library/Frameworks/dwf.framework/`
  - **Windows**: `C:\Windows\System32\dwf.dll`
  - **Linux**: `/usr/lib/libdwf.so`

**Error: "Failed to open device"**
- Probably not connect or another application is using the device.

### Data Acquisition Issues

**No trigger detected**
- Best option here is to check with the WaveForms application to ensure the signal is reaching the oscilloscope and that the trigger settings are appropriate for your signal.


## Contributing

This project is part of a Master's thesis research on TENG. For questions or contributions, just reach out.

## Acknowledgments

- Digilent Inc. for the Analog Discovery hardware and SDK
- Built for TENG research and characterization

---

**Last Updated**: December 2025
